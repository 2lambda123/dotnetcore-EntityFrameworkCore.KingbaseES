namespace Kdbndp.EntityFrameworkCore.KingbaseES.Storage.Internal.Mapping;

/// <summary>
///     This is an internal API that supports the Entity Framework Core
///     infrastructure and not subject to the same compatibility standards as
///     public APIs. It may be changed or removed without notice in any release.
///     You should only use it directly in your code with extreme caution and
///     knowing that doing so can result in application failures when updating
///     to a new Entity Framework Core release.
/// </summary>
public class KdbndpDoubleTypeMapping : DoubleTypeMapping {
  /// <summary>
  ///     This is an internal API that supports the Entity Framework Core
  ///     infrastructure and not subject to the same compatibility standards as
  ///     public APIs. It may be changed or removed without notice in any
  ///     release. You should only use it directly in your code with extreme
  ///     caution and knowing that doing so can result in application failures
  ///     when updating to a new Entity Framework Core release.
  /// </summary>
  public static new KdbndpDoubleTypeMapping Default { get;
}
= new();

/// <summary>
///     This is an internal API that supports the Entity Framework Core
///     infrastructure and not subject to the same compatibility standards as
///     public APIs. It may be changed or removed without notice in any release.
///     You should only use it directly in your code with extreme caution and
///     knowing that doing so can result in application failures when updating
///     to a new Entity Framework Core release.
/// </summary>
public KdbndpDoubleTypeMapping()
    : base("double precision", System.Data.DbType.Double) {}

/// <summary>
///     This is an internal API that supports the Entity Framework Core
///     infrastructure and not subject to the same compatibility standards as
///     public APIs. It may be changed or removed without notice in any release.
///     You should only use it directly in your code with extreme caution and
///     knowing that doing so can result in application failures when updating
///     to a new Entity Framework Core release.
/// </summary>
protected KdbndpDoubleTypeMapping(RelationalTypeMappingParameters parameters)
    : base(parameters) {}

/// <summary>
///     This is an internal API that supports the Entity Framework Core
///     infrastructure and not subject to the same compatibility standards as
///     public APIs. It may be changed or removed without notice in any release.
///     You should only use it directly in your code with extreme caution and
///     knowing that doing so can result in application failures when updating
///     to a new Entity Framework Core release.
/// </summary>
protected override
    RelationalTypeMapping Clone(RelationalTypeMappingParameters parameters) =>
        new KdbndpDoubleTypeMapping(parameters);

/// <summary>
///     This is an internal API that supports the Entity Framework Core
///     infrastructure and not subject to the same compatibility standards as
///     public APIs. It may be changed or removed without notice in any release.
///     You should only use it directly in your code with extreme caution and
///     knowing that doing so can result in application failures when updating
///     to a new Entity Framework Core release.
/// </summary>
protected override string GenerateNonNullSqlLiteral(object value) =>
    Convert.ToDouble(value) switch {
      var d when double.IsNaN(d) => "'NaN'",
      var d when double.IsPositiveInfinity(d) => "'Infinity'",
      var d when double.IsNegativeInfinity(d) => "'-Infinity'",
      var d => base.GenerateNonNullSqlLiteral(d)
    };
}
